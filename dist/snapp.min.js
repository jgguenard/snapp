var sn;
(function(c){c.vdom={operation:{APPEND_CHILD:"APPEND_CHILD",REPLACE_CHILD:"REPLACE_CHILD",REMOVE_CHILD:"REMOVE_CHILD",REMOVE_ATTRIBUTE:"REMOVE_ATTRIBUTE",SET_ATTRIBUTE:"SET_ATTRIBUTE",SET_TEXT_CONTENT:"SET_TEXT_CONTENT",SET_EVENT:"SET_EVENT"},allowedTagName:"A ABBR ADDRESS AREA ARTICLE ASIDE AUDIO B BASE BDI BDO BGSOUND BLOCKQUOTE BODY BR BUTTON CANVAS CAPTION CITE CODE COL COLGROUP COMMAND CONTENT DATA DATALIST DD DEL DETAILS DFN DIALOG DIV DL DT ELEMENT EM EMBED FIELDSET FIGCAPTION FIGURE FONT FOOTER FORM H1 H2 H3 H4 H5 H6 HEAD HEADER HGROUP HR HTML I IFRAME IMAGE IMG INPUT INS KBD KEYGEN LABEL LEGEND LI LINK MAIN MAP MARK MARQUEE MENU MENUITEM META METER MULTICOL NAV NOBR NOEMBED NOFRAMES NOSCRIPT OBJECT OL OPTGROUP OPTION OUTPUT P PARAM PICTURE PRE PROGRESS Q RP RT RTC RUBY S SAMP SCRIPT SECTION SELECT SHADOW SMALL SOURCE SPAN STRONG STYLE SUB SUMMARY SUP TABLE TBODY TD TEMPLATE TEXTAREA TFOOT TH THEAD TIME TITLE TR TRACK U UL VAR VIDEO WBR".split(" "),node:{COMMENT:8,
ELEMENT:1,TEXT:3,COMPONENT:99},setAttribute:function(a,b,d){!0===a.$virtual?a.attributes[b]=d:"class"===b?a.className=d:"style"===b?a.style.cssText=d:"type"!==b&&b in a||"string"!==typeof d?a[b]=null==d?"":d:a.setAttribute?a.setAttribute(b,d):a.attributes&&(a.attributes[b].value=d)},getAttribute:function(a,b){return!0===a.$virtual?a.attributes[b]:"class"===b?a.className:"style"===b?a.style.cssText:"type"!==b&&b in a?a[b]:a.getAttribute?a.getAttribute(b):a.attributes?a.attributes[b].value:null},removeAttribute:function(a,
b){!0===a.$virtual?delete a.attributes[b]:"class"===b?a.className="":"style"===b?a.style.cssText="":"type"!==b&&b in a?a[b]="":a.removeAttribute?a.removeAttribute(b):a.attributes&&delete a.attributes[b]},patch:function(a,b){for(var d in a){var e=a[d];switch(e.type){case c.vdom.operation.APPEND_CHILD:e.target.appendChild(this.createRealNode(e.child,b));break;case c.vdom.operation.REPLACE_CHILD:e.target.replaceChild(this.createRealNode(e.child,b),e.oldChild);break;case c.vdom.operation.REMOVE_CHILD:e.target.removeChild(e.child);
break;case c.vdom.operation.REMOVE_ATTRIBUTE:this.removeAttribute(e.target,e.name);break;case c.vdom.operation.SET_ATTRIBUTE:"function"===typeof e.value&&(e.value=e.value.bind(b));this.setAttribute(e.target,e.name,e.value);break;case c.vdom.operation.SET_TEXT_CONTENT:e.target.textContent=e.value}}},diff:function(a,b,d){var e=[],g=a.attributes||[],f=b.attributes||{};if(!d){for(d=0;d<g.length;d++){var h=g[d],k=f[h.name],m=this.getAttribute(a,h.name),n=this.getAttribute(b,h.name);k?m!==n&&e.push({type:c.vdom.operation.SET_ATTRIBUTE,
target:a,name:h.name,value:n}):e.push({type:c.vdom.operation.REMOVE_ATTRIBUTE,target:a,name:h.name})}for(var l in f){f=!1;for(d=0;d<g.length;d++)if(g[d].name===l){f=!0;break}f||(f=this.getAttribute(b,l),e.push({type:c.vdom.operation.SET_ATTRIBUTE,target:a,name:l,value:f}))}}b.nodeType===c.vdom.node.TEXT&&b.textContent!=a.textContent&&e.push({type:c.vdom.operation.SET_TEXT_CONTENT,target:a,value:b.textContent});l=b.childNodes?b.childNodes.length:0;g=a.childNodes?a.childNodes.length:0;for(f=0;f<l;f++)if(d=
b.childNodes[f],h=a.childNodes?a.childNodes[f]:null)if(c.isEmpty(d))e.push({type:c.vdom.operation.REMOVE_CHILD,target:a,child:a.childNodes[f]});else if(h.nodeType!==d.nodeType||h.tagName!==d.tagName){var m=(k=d.nodeType===c.vdom.node.COMPONENT)?d.tagName.name:null,p=(n=this.getAttribute(h,"data-sn-component"))?n.definition.name:null;(!k||n&&p!==m)&&e.push({type:c.vdom.operation.REPLACE_CHILD,target:a,child:d,oldChild:h})}else e=e.concat(this.diff(h,d));else c.isEmpty(d)||e.push({type:c.vdom.operation.APPEND_CHILD,
target:a,child:d});if(l<g)for(b=l;b<g;b++)e.push({type:c.vdom.operation.REMOVE_CHILD,target:a,child:a.childNodes[b]});return e},createRealNode:function(a,b){var d;if(a.nodeType===c.vdom.node.TEXT)d=document.createTextNode(a.textContent);else if(a.nodeType===c.vdom.node.ELEMENT){d=document.createElement(a.tagName);if(a.attributes)for(var e in a.attributes){var g=a.attributes[e];"function"===typeof g&&(g=g.bind(b));this.setAttribute(d,e,g)}if(a.childNodes){e=document.createDocumentFragment();for(g=
0;g<a.childNodes.length;g++){var f=a.childNodes[g];f&&e.appendChild(this.createRealNode(f,b))}d.appendChild&&d.appendChild(e)}}else a.nodeType===c.vdom.node.COMPONENT&&(d=document.createElement("DIV"),c.mount(d,a.tagName,a.attributes));return d},createVirtualNode:function(a,b,d){c.isDefined(d)||!c.isDefined(b)||!c.isArray(b)&&c.isObject(b)&&!0!==b.$virtual||(d=b,b=null);if(c.isObject(a))a={nodeType:c.vdom.node.COMPONENT,tagName:a,attributes:b};else{var e=a.toString().toUpperCase();c.inArray(c.vdom.allowedTagName,
e)?(a={tagName:e,nodeType:c.vdom.node.ELEMENT,attributes:b},c.isArray(d)?a.childNodes=d:c.isObject(d)?a.childNodes=[d]:c.isEmpty(d)||(a.childNodes=[{nodeType:c.vdom.node.TEXT,textContent:d}])):a={nodeType:c.vdom.node.TEXT,textContent:a}}a.$virtual=!0;return a}}})(sn||(sn={}));var el=sn.vdom.createVirtualNode;
(function(c){c.event={observers:{},emit:function(a,b){var d=this.observers[a];if(d)for(var c in d)d[c].callback(b)},addListener:function(a,b,d){this.observers[a]||(this.observers[a]=[]);var e=c.guid();this.observers[a].push({id:e,priority:d||1E3,callback:b});this.observers[a].sort(function(b,a){return b.priority<a.priority?-1:b.priority>a.priority?1:0});return e},removeListeners:function(a){this.observers[a]&&(this.observers[a]=null)},removeListener:function(a,b){if(this.observers[a])for(var d in this.observers[a])if(this.observers[d].id===
b){delete this.observers[d];break}}}})(sn||(sn={}));
(function(c){c.router={routes:{},params:[],named_params:{},enabled:!1,getPath:function(){var a=window.location.href.match(/#(.*)$/);return"/"+this.clearSlashes(a?a[1]:"")},clearSlashes:function(a){return a.toString().replace(/\/$/,"").replace(/^\//,"")},param:function(a,b){return c.isInteger(a)?this.params[a]||b:this.named_params[a]||b},update:function(){var a=this,b=this.getPath(),d=[],e={},b=b.replace(/[?&]+([^=&]+)=?([^&]*)?/gi,function(b,a,d){e[a]=decodeURIComponent(d);return""}),g={},f;for(f in this.routes){g.rule=
f;var h="^"+g.rule.replace(/:[^/]+/g,"([^/]+)")+"$";if(h=b.match(h)){h.shift();var b=g.rule.match(/:([^/:]+)/g),k;for(k in b)f=decodeURIComponent(h[k]),d.push(f),e[b[k].replace(":","")]=f;this.params=d;this.named_params=e;setTimeout(function(b){return function(){c.log("Taking route "+b.rule);a.routes[b.rule]();c.event.emit("sn.route.update",b.rule)}}(g),0);break}g={rule:g.rule}}},setEnabled:function(a){!0!==a||this.enabled?a||(window.removeEventListener("hashchange",this.update.bind(this)),this.enabled=
!1):(window.addEventListener("hashchange",this.update.bind(this)),this.enabled=!0,this.update())},setRoutes:function(a){this.routes=a;this.setEnabled(!0)},route:function(a,b){if(b)for(var d in b)a=a.replace(":"+d,encodeURIComponent(b[d]));window.location.href=window.location.href.replace(/#(.*)$/,"")+"#"+a}}})(sn||(sn={}));
(function(c){c.component={lifeCycle:["init","update","render","dispose"],abortComponentRendering:function(b){b.$pendingRendering&&(c.log("Ignoring rendering request of component <"+b.definition.name+">"),clearTimeout(b.$pendingRendering))},requestComponentRendering:function(b){this.abortComponentRendering(b);b.$pendingRendering=setTimeout(function(){b.render();b.$pendingRendering=null},0)},observablePropertyChanged:function(b,a,e,g,f,h){c.log("Rendering component <"+b.definition.name+"> triggered by <"+
g.toString()+"> of scope <!"+a+">");this.requestComponentRendering(b);if(b=e.$observers?e.$observers[g]:null)for(var k in b)b[k](f,h)},observe:function(b,a,c){a.$observers||(a.$observers={});a.$observers[b]||(a.$observers[b]=[]);a.$observers[b].push(c)}};var a=function(b){this.definition=b;this.observables=[];this.scope=this.createScope()};a.prototype.createScope=function(b){var a=this,e=c.guid();return new Proxy(b||{},{get:function(b,f){var h=e+f.toString();!c.isDefined(b[f])||c.isFunction(b[f])||
"__proto__"===f||f.toString().startsWith("$")||c.inArray(a.observables,h)||(c.log("Observing property <"+f.toString()+"> of scope <"+e+">"),a.observables.push(h));return b[f]},set:function(b,f,h){var k=e+f.toString(),m=b[f];"object"!==typeof h||f.toString().startsWith("$")||(h=a.createScope(h));b[f]=h;h!==m&&!c.isFunction(h)&&c.inArray(a.observables,k)&&c.component.observablePropertyChanged(a,e,b,f,h,m);return!0}})};a.prototype.mount=function(b,a){c.log("Mounting component <"+this.definition.name+
">");var e=c.vdom.getAttribute(b,"data-sn-component");c.isDefined(e)&&e.dispose();c.vdom.setAttribute(b,"data-sn-component",this);this.container=b;for(var g in this.definition)"function"==typeof this.definition[g]&&0>c.component.lifeCycle.indexOf(g)&&(this.scope[g]=this.definition[g]);this.init(a);this.update(a);c.log("Component <"+this.definition.name+"> mounted")};a.prototype.controller=function(b,a){if(this.definition[b])if(arguments){var c=[],g;for(g in a)c.push(a[g]);this.definition[b].apply(this.scope,
c)}else this.definition[b].call(this.scope)};a.prototype.init=function(b){this.controller("init",b);c.log("Component <"+this.definition.name+"> initialized")};a.prototype.update=function(b){this.controller("update",b);c.component.requestComponentRendering(this);c.log("Component <"+this.definition.name+"> updated")};a.prototype.render=function(){if(this.definition.render){var b=this.definition.render.call(this.scope),b=c.vdom.createVirtualNode(this.container.tagName,null,b),b=c.vdom.diff(this.container,
b,!0);c.vdom.patch(b,this.scope);c.log("Component <"+this.definition.name+"> rendered")}};a.prototype.dispose=function(){c.component.abortComponentRendering(this);this.definition.dispose&&this.definition.dispose.call(this.scope);c.log("Component <"+this.definition.name+"> unmounted")};c.Component=a})(sn||(sn={}));
(function(c){var a=function(b,a,e,g){this.url=a;this.method=b;this.data=e;this.options=c.extend({timeout:5E3,async:!0,dataType:"JSON",withCredentials:!1,ct:"application/x-www-form-urlencoded"},g||{});this.init()};a.prototype.prepareParams=function(b,a){var c=[],g;for(g in b)if(b.hasOwnProperty(g)){var f=a?a+"["+g+"]":g,h=b[g];c.push("object"==typeof h?this.prepareParams(h,f):encodeURIComponent(f)+"="+encodeURIComponent(h))}return c.join("&")};a.prototype.stringToJSON=function(b){return JSON.parse(b)};
a.prototype.abort=function(){this.xhr.abort();this.failCallback&&this.failCallback(this.xhr.status);this.alwaysCallback&&this.alwaysCallback()};a.prototype.init=function(){var b=this;try{this.xhr=new XMLHttpRequest}catch(a){try{this.xhr=new ActiveXObject("Msxml2.XMLHTTP")}catch(f){return c.error("XMLHttpRequest not supported"),null}}this.xhr.withCredentials&&(this.xhr.withCredentials=this.options.withCredentials);this.xhr.onreadystatechange=function(){if(4==b.xhr.readyState){clearTimeout(b.requestTimeout);
if(200!=b.xhr.status)b.failCallback&&b.failCallback(b.xhr.responseText,b.xhr);else{var a=b.xhr.responseText;"JSON"===b.options.dataType&&(a=b.stringToJSON(a));b.successCallback&&b.successCallback(a,b.xhr)}b.alwaysCallback&&b.alwaysCallback(b.xhr.responseText,b.xhr)}};this.requestTimeout=setTimeout(function(){b.abort()},this.options.timeout);var d=this.method.toUpperCase(),e=this.url+(this.data&&"GET"===d?"?"+this.prepareParams(this.data):"");this.xhr.open(d,e,this.options.async);"POST"===d&&this.data?
(this.xhr.setRequestHeader("Content-type",this.options.ct),this.xhr.send(this.prepareParams(this.data))):this.xhr.send(null)};a.prototype.success=function(b){this.successCallback=b;return this};a.prototype.fail=function(b){this.failCallback=b;return this};a.prototype.always=function(b){this.alwaysCallback=b;return this};c.RequestObject=a;c.request={get:function(b,a,e){return new c.RequestObject("GET",b,a,e)},post:function(b,a,e){return new c.RequestObject("POST",b,a,e)}}})(sn||(sn={}));
(function(c){c.validation={required:function(a){return!c.isEmpty(a)}}})(sn||(sn={}));
(function(c){c.form=function(b,a){return new c.FormObject(b,a)};c.FormField={name:"FormField",init:function(b,a,e,g){var f=this;this.value=b[a]||"";c.component.observe(a,b,function(b,c){f.$form.validateField(a,b);f.value=b})},update:function(a,d,e,g){var f=this;this.$form=a;this.$options=c.extend({updateEvent:"onchange",updateDebounce:0,choices:null,multiline:!1},g||{});this.$attributes=c.extend({name:d},e||{});var h=function(a){f.$form.setFieldValue(d,a.target.value);f.$form.setPristine(!1)},k;this.$attributes[this.$options.updateEvent]=
this.$options.updateDebounce?function(a){clearTimeout(k);k=setTimeout(h.bind(f,a),f.$options.updateDebounce)}:h},render:function(){var a=c.extend({},this.$attributes),d=c.isEmpty(a["class"]||"")?"":" ";c.isEmpty(this.$form.$errors[a.name])?d+="sn-valid":(d+="sn-invalid",this.$form.$errors[a.name].map(function(a){d+=" sn-invalid-"+a.replace("_","-")}));a["class"]=d;var e=this.$options.choices?"SELECT":!0===this.$options.multiline?"TEXTAREA":"INPUT",g=[];if("SELECT"===e)for(var f in this.$options.choices)g.push(el("option",
{value:f,selected:f==this.value},this.$options.choices[f]));else"INPUT"===e?(a.type||(a.type="text"),"checkbox"===a.type?(a.checked=this.$options.value==this.value,a.value=this.$options.value):"radio"===a.type?a.checked=a.value==this.value:a.value=this.value):a.value=this.value;return el(e,a,g)}};var a=function(a,d){this.$fields=a||{};this.$errors={};this.$pristine=!0;c.isDefined(d)&&this.setFieldsValue(d)};a.prototype.serialize=function(){var a={},c;for(c in this.$fields)a[c]=this[c];return a};a.prototype.setPristine=
function(a){this.$pristine=!0===a};a.prototype.setFieldValue=function(a,c){this[a]=c};a.prototype.setFieldsValue=function(a){for(var c in a)this.setFieldValue(c,a[c])};a.prototype.isValid=function(){for(var a in this.$errors)if(!c.isEmpty(this.$errors[a]))return!1;return!0};a.prototype.isPristine=function(){return this.$pristine};a.prototype.validateField=function(a,d){var e=[];if(this.$fields[a]){var g=this.$fields[a].validation;if(!c.isEmpty(g)){c.isArray(g)||(g=[g]);for(var f in g){var h=g[f];
!0!==c.validation[h](d)&&e.push(h)}}}this.$errors[a]=e;return 0>e.length};a.prototype.field=function(a,d){return el(c.FormField,{form:this,name:a,attributes:d,options:this.$fields[a]})};c.FormObject=a})(sn||(sn={}));
(function(c){c.version="0.1";c.config={logPrefix:"sn: ",debug:!1};c.error=function(a){if(!0===c.config.debug)throw Error(c.config.logPrefix+a);};c.log=function(a){!0===c.config.debug&&console.log(c.config.logPrefix+a)};c.extend=function(a,b){return Object.assign?Object.assign(a,b):a};c.isObject=function(a){return"object"===typeof a};c.isArray=function(a){return Array.isArray(a)};c.isDefined=function(a){return void 0!==a&&null!==a};c.isFunction=function(a){return"function"===typeof a};c.inArray=function(a,
b){return 0<=a.indexOf(b)};c.isInteger=function(a){var b;return isNaN(a)?!1:(b=parseFloat(a),(0|b)===b)};c.guid=function(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()};c.isEmpty=function(a){return!c.isDefined(a)||""===a||c.isArray(a)&&1>a.length||c.isObject(a)&&1>Object.keys(a).length};c.mount=function(a,b,d){var e=c.vdom.getAttribute(a,"data-sn-component");e&&e.definition===b?e.update(d):(new c.Component(b)).mount(a,
d)}})(sn||(sn={}));
